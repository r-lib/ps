<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Mark a process and its (future) child tree — ps_mark_tree • ps</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mark a process and its (future) child tree — ps_mark_tree"><meta name="description" content="ps_mark_tree() generates a random environment variable name and sets
it in the  current R process. This environment variable will be (by
default) inherited by all child (and grandchild, etc.) processes, and
will help finding these processes, even if and when they are (no longer)
related to the current R process. (I.e. they are not connected in the
process tree.)"><meta property="og:description" content="ps_mark_tree() generates a random environment variable name and sets
it in the  current R process. This environment variable will be (by
default) inherited by all child (and grandchild, etc.) processes, and
will help finding these processes, even if and when they are (no longer)
related to the current R process. (I.e. they are not connected in the
process tree.)"><meta name="robots" content="noindex"><script defer data-domain="ps.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ps</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.8.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/ps/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Mark a process and its (future) child tree</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/ps/blob/main/R/kill-tree.R" class="external-link"><code>R/kill-tree.R</code></a></small>
      <div class="d-none name"><code>ps_kill_tree.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>ps_mark_tree()</code> generates a random environment variable name and sets
it in the  current R process. This environment variable will be (by
default) inherited by all child (and grandchild, etc.) processes, and
will help finding these processes, even if and when they are (no longer)
related to the current R process. (I.e. they are not connected in the
process tree.)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ps_mark_tree</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">with_process_cleanup</span><span class="op">(</span><span class="va">expr</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ps_find_tree</span><span class="op">(</span><span class="va">marker</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ps_kill_tree</span><span class="op">(</span><span class="va">marker</span>, sig <span class="op">=</span> <span class="fu"><a href="signals.html">signals</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">SIGKILL</span>, grace <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-expr">expr<a class="anchor" aria-label="anchor" href="#arg-expr"></a></dt>
<dd><p>R expression to evaluate in the new context.</p></dd>


<dt id="arg-marker">marker<a class="anchor" aria-label="anchor" href="#arg-marker"></a></dt>
<dd><p>String scalar, the name of the environment variable to
use to find the marked processes.</p></dd>


<dt id="arg-sig">sig<a class="anchor" aria-label="anchor" href="#arg-sig"></a></dt>
<dd><p>The signal to send to the marked processes on Unix. On
Windows this argument is ignored currently.</p></dd>


<dt id="arg-grace">grace<a class="anchor" aria-label="anchor" href="#arg-grace"></a></dt>
<dd><p>Grace period, in milliseconds, used on Unix, if <code>sig</code> is
<code>SIGKILL</code>.  If it is not zero, then <code>ps_kill_tree()</code> first sends a
<code>SIGTERM</code> signal to all processes. If some proccesses do not
terminate within <code>grace</code> milliseconds after the <code>SIGTERM</code> signal,
<code>ps_kill_tree()</code> kills them by sending <code>SIGKILL</code> signals.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>ps_mark_tree()</code> returns the name of the environment variable,
which can be used as the <code>marker</code> in <code>ps_kill_tree()</code>.</p>
<p><code>ps_find_tree()</code> returns a list of <code>ps_handle</code> objects.</p>
<p><code>ps_kill_tree()</code> returns the pids of the killed processes, in a named
integer vector. The names are the file names of the executables, when
available.</p>
<p><code>with_process_cleanup()</code> returns the value of the evaluated expression.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>ps_find_tree()</code> finds the processes that set the supplied environment
variable and returns them in a list.</p>
<p><code>ps_kill_tree()</code> finds the processes that set the supplied environment
variable, and kills them (or sends them the specified signal on Unix).</p>
<p><code>with_process_cleanup()</code> evaluates an R expression, and cleans up all
external processes that were started by the R process while evaluating
the expression. This includes child processes of child processes, etc.,
recursively. It returns a list with entries: <code>result</code> is the result of
the expression, <code>visible</code> is TRUE if the expression should be printed
to the screen, and <code>process_cleanup</code> is a named integer vector of the
cleaned pids, names are the process names.</p>
<p>If <code>expr</code> throws an error, then so does <code>with_process_cleanup()</code>, the
same error. Nevertheless processes are still cleaned up.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>


<p>Note that <code>with_process_cleanup()</code> is problematic if the R process is
multi-threaded and the other threads start subprocesses.
<code>with_process_cleanup()</code> cleans up those processes as well, which is
probably not what you want. This is an issue for example in RStudio.
Do not use <code>with_process_cleanup()</code>, unless you are sure that the
R process is single-threaded, or the other threads do not start
subprocesses. E.g. using it in package test cases is usually fine,
because RStudio runs these in a separate single-threaded process.</p>
<p>The same holds for manually running <code>ps_mark_tree()</code> and then
<code>ps_find_tree()</code> or <code>ps_kill_tree()</code>.</p>
<p>A safe way to use process cleanup is to use the processx package to
start subprocesses, and set the <code>cleanup_tree = TRUE</code> in
<code><a href="http://processx.r-lib.org/reference/run.html" class="external-link">processx::run()</a></code> or the <a href="http://processx.r-lib.org/reference/process.html" class="external-link">processx::process</a> constructor.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Jay Loden, Dave Daeschler, Giampaolo Rodola’, <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

  </div></footer></body></html>

